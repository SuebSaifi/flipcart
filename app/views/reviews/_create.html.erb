<%Review.all.each do |review|%>
    <%if review.product_id==@product.id%>
        <hr>
        <div class="review d-flex justify-content-between mx-4"  >    
            <div >
                <%if @product.id==review.product_id%>  
                        <% unless review.parent_id || !review.persisted? %>
                            <span class="fs-6"> <%=review.review%></span><br/>
                            <span class="text-muted"><%=review.user.first_name%></span><br/>
                            <%=link_to "reply",new_product_review_reply_path(@product,review_id: review.id),remote: true%><br/>
                            <div id="reply-form-<%= review.id %>"></div>
                            <hr style="width:550px">
                        <%end%>
                    <div class="mx-4">
                    <%if review.replies.any?%>
                        <%review.replies.each do |reply|%>
                     <% unless reply.parent_id || !reply.persisted? %>
                        <%=reply.user.first_name%><br/>
                        <%=reply.reply%><br/>
                        <%= link_to 'reply', new_product_review_reply_path(@product,review, parent_id: reply.id), remote: true%>
                        <%=link_to product_review_reply_path(@product,review,reply),remote: true , method: :delete,class:"delete_reply",data: {confirm:"Are you sure you want to delete this review?"} do %>
                        <span class="icon"><i class="bi bi-trash"aria-hidden="true"></i></span> 
                        <hr>
                        <%end%><br/>
                         <div class="mx-4">
                            <%if reply.replies.any?%>
                                <%reply.replies.each do |reply|%>
                                    <%=reply.user.first_name%><br/>
                                    <%reply.reply%><br/>
                                    <%= link_to 'reply', new_product_review_reply_path(@product,review, parent_id: reply.id), remote: true%>
                                    <%=link_to product_review_reply_path(@product,review,reply),remote: true , method: :delete,class:"delete_reply",data: {confirm:"Are you sure you want to delete this review?"} do %>
                                    <span class="icon"><i class="bi bi-trash"aria-hidden="true"></i></span> 
                                <%end%><br/>
                            <%end%><br/>
                            
                        <hr>
                        <%end%>
                        </div>
                    <%end%>
                        
                    <%end%>
                <%end%>
                    </div>
                <%end%>            
            </div>
            <%if review.user.id==current_user.id%>
                <div >
                 <% unless review.parent_id || !review.persisted? %>
                  <%=link_to product_review_path(@product,review),remote: true , method: :delete,id:"delete_review",data: {confirm:"Are you sure you want to delete this review?"} do %>
                      <span class="icon"><i class="bi bi-trash"aria-hidden="true"></i></span> 
                  <%end%>
                  <%end%>
                </div>    
            <%end%>           
        </div>
    <%end%>   
<%end%>